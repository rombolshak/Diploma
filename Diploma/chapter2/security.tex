\section{Секретность протокола относительно различных атак}
Протокол релятивистского квантового распределения ключей преследует две цели: первое, предоставить само распределение ключей и, второе, синхронизировать часы между Алисой и Бобом.
Важную роль в обеспечении секретности играют релятивизм вкупе с протяженностью состояния, а также посылка Алисой состояний в случайные моменты времени.
Рассмотрим возможные действия Евы в отсутствие какого-либо компонента из этих двух.

\subsection{Необходимость протяженности состояния и ограничений специальной теории относительности}
Поясним, почему для получения информации о ключе необходимо иметь доступ к двум <<половинкам>> состояния, локализованным во временных окнах 1 и 2.

Информация о ключе заключена в относительной фазе двух состояний, $|\alpha\rangle_1$ и $|e^{i\varphi_B}\alpha\rangle_2$.
Из (\ref{eva_density_matrix_one_half}) видно, что информация о фазе при доступе только к одной половинке полностью теряется.
Таким образом, чтобы получить состояние, которое зависит от относительной фазы $\varphi_B$, несущей информацию о ключе, злоумышленнику необходимо иметь доступ к двум половинкам состояния.

\begin{comment}
\begin{eqnarray}\label{eva_density_matrix_full}
    \rho(\varphi_B) = \int^{2\pi}_0 
{
\frac{d\theta}{2\pi} 
|\sqrt{\mu} e^{i(\varphi_{B} + \theta)} \rangle_1 ~ 
{}_1 \langle \sqrt{\mu}e^{-i(\varphi_{B} + \theta)} |
\otimes
|\sqrt{\mu} e^{i\theta} \rangle_2 ~ 
{}_2 \langle \sqrt{\mu}e^{-i\theta} |
} =  \nonumber\\
e^{-2\mu} \sum^\infty_{n,k,n',k'=0} 
{
  e^{i\varphi_B(n-n')}
  \frac
    {\mu^{\frac{n+k-n'-k'}{2}}}
    {\sqrt{n!k!n'!k'!}} 
  |k\rangle_1 
  \otimes
  |n\rangle_2 ~{}_2 \langle n' | 
  \otimes
  ~{}_1 \langle k' | \delta_{n+k,n'+k'}.
}
\end{eqnarray}

Таким образом, для получения информации о ключе необходим доступ к двум половинкам состояния.
\end{comment}

В нерелятивистской квантовой криптографии возможны следующие атаки.
\begin{itemize}
  \item Атака <<прием-перепосыл>>: Ева в каждой посылке измеряет состояния, затем в зависимости от исхода измерения посылает свои состояния.
  \item Коллективная атака: Ева готовит в каждой посылке свое состояние (анциллу), которое при помощи унитарного преобразования запутывается с информационным состоянием.
  Анцилла остается в квантовой памяти для дальнейших коллективных измерений сразу над всей последовательностью, а модифицированное состояние направляется к Алисе (Бобу).
\end{itemize}

В релятивистском случае обе атаки приводят к задержкам и к вероятности ошибки 50\% в каждой посылке.

Причина состоит в следующем. Для различения матриц плотности и получения информации о ключе, $\rho(\varphi_B = \varphi_0)$ и $\rho(\varphi_B = \varphi_1)$, которые нелокальны в пространстве-времени (локализованы во временных окнах 1 и 2), необходимо иметь доступ к двум половинкам одновременно.

Любое унитарное преобразование, сводящее две разделенные в пространстве-времени Минковского половинки состояний, требует конечного времени (ситуация поясняется на рис. \ref{fig:detected}). 
Более формально, время, необходимое для сведения половинок вместе, диктуется фундаментальными ограничениями специальной теории относительности.
Данное время равно высоте прошлой части светового конуса, накрывающего обе половинки. 
После сведения половинок вместе Ева может делать либо унитарные преобразования состояния, либо измерения с определенным исходом.

Затем ей снова необходимо приготовить протяженное в пространстве-времени состояние. На это также требуется конечное время, равное высоте будущей части светового конуса. 
Однако при этом исходные состояния, которые распространяются со скоростью света, окажутся уже сдвинутыми в пространстве-времени по отношению к новому состоянию Евы.
Поскольку Алиса делает преобразования и измерения только в определенном временном окне (рис \ref{fig:process}), вторая половинка состояния не успеет прибыть и не будет участвовать в преобразованиях. Вместо истинного состояния $| \frac{e^{i(\varphi_B - \varphi_A)}\alpha}{2}\rangle_2$ в центральном временном окне 2 окажется состояние $| \frac{e^{i\varphi_B}\alpha}{2} \rangle_2$ (см. рис. \ref{fig:process} и формулу (\ref{eva_density_matrix_one_half})). 
Такое состояние даст вероятность ошибки 50\%, поскольку оно не зависит от выбора фазы Алисы.

Конечно, Ева может заранее приготовить первую половинку состояния, сделать преобразования, сводящие половинки состояний Боба вместе, провести UM-измерения и в случае определенного исхода приготовить вторую половинку с нужной фазой. В этом случае задержек и ошибок на стороне Алисы не будет. Однако из-за неортогональности состояний неизбежно будут неопределенные исходы, при которых Ева не знает состояния (она может только пытаься случайно угадать фазу). Однако при угадывании на стороне Алисы вероятность ошибки составит все те же 50\%. При неопределенном исходе Ева уже не сможет блокировать свою заранее приготовленную половинку из-за ограничений специальной теории относительности.

\subsection{Необходимость посылки состояния в случайный момент}
Поясним, почему Алиса должна посылать свои состояния в случайные и известные только ей моменты времени. Поскольку часы у Алисы и Боба не синхронизированы, Боб не знает, когда он получит состояния от Алисы. Если б Алиса посылала состояния в регулярные и известные всем моменты времени, то Ева могла бы действовать следующим образом.

Ева заранее, до прихода к себе состояния от Алисы, посылает к Бобу состояние, аналогичное состоянию Алисы (которое не несет никакой информации о ключе и каждый раз одинаково). 
Затем, получив назад от Боба свое ослабленное когерентное состояние, уже несущее информацию о ключе, она делает измерения с определенным исходом \cite{scarani2009secpraquakeydis}. 
Поскольку состояния неортогональны, Ева может с некоторой вероятностью получить как определенный исход, так и неопределенный. 
Если получен определенный исход, то Ева однозначно знает передаваемый бит ключа. 
Тот факт, что на такое измерение требуется конечное время, для Евы не важен, поскольку она заранее посылает свои состояния и поэтому имеет необходимый запас времени. 
При определенном исходе Ева готовит свое состояние, аналогичное теперь уже известному состоянию Боба, и посылает его в нужный момент времени, после регистрации классического состояния Алисы, чтобы не вызвать задержки измерений у Алисы. 
Исходное состояние Алисы, которое приходит к ней позднее, Ева блокирует.

Если же Евой получен неопределенный исход, то Ева ничего не посылает Алисе и блокирует приход ее состояния к Бобу. 
Потеря состояния списывается на потери в канале связи, которые не контролируются и могут быть любыми. 
При такой стратегии Ева знала бы весь ключ и не производила задержек и ошибок на стороне Алисы.

При посылке Алисой состояний в случайные моменты времени, а затем сравнении моментов прихода состояний в соседних посылках к Бобу такая стратегия не работает, поскольку посылка Евой состояния к Бобу в неправильный момент времени неизбежно приведет к ее обнаружению.
Такие посылки отбрасываются. Пусть доля таких посылок есть $\eta$. Если Алиса выбирает случайные моменты посылки из двух возможностей, то вероятность угадывания Евой составляет 1/2. В асимптотическом пределе большого числа посылок из доли $\eta$ Ева знает значения бита в половине этих посылок, где она угадала правильный момент и при этом не произошло сбоя момента прихода состояния к Бобу.

\paragraph*{}
Как видно из анализа выше, для детектирования любых попыток подслушивания в данном протоколе важны как ограничения квантовой механики на принципиальную неразличимость неортогональных квантовых состояний, так и ограничения специальной теории относительности на предельную скорость передачи каких бы то ни было физических состояний, как квантовых, так и классических.

Ограничения специальной теории относительности принципиальны для детектирования атаки с UM-измерениями. Все протоколы нерелятивистской квантовой криптографии без контроля затухания становятся несекретными при определеленных потерях, поскольку Ева при UM-измерениях не производит ошибок и знает весь ключ, начиная с критической величины потерь \cite{scarani2009secpraquakeydis}. В даннном случае ошибки неизбежны из-за нехватки времени (релятивистское ограничение) и неортогональности квантовых состояний (квантовомеханический запрет на достоверную различимость неортогональных состояний).