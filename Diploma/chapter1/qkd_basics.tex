\section{Базовые протоколы квантового распределения ключей}
К 1984 году основная часть описанных результатов уже была известна, и их оказалось достаточно для того, чтобы сформулировать принципы квантовой криптографии и предоставить доводы в пользу секретности такого способа распределения ключей. 

Основные факты квантовой теории информации, на которых основывается квантовая криптография~--- связанные между собой утверждения о невозможности клонирования произвольных квантовых состояний (\ref{no_cloning_theorem}) и о невозможности достоверного различения неортогональных состояний (\ref{no_discrimination_theorem}). В сочетании эти результаты дают тот факт, что попытки различения квантовых состояний из неортогонального набора ведут к помехам, а значит, действия перехватчика могут быть детектированы по величине ошибки на приёмной стороне.

Важно заметить, что квантовая криптография не делает никаких предположений о характере действий подслушивателя и объеме доступных ему ресурсов: предполагается, что перехватчик может обладать любыми ресурсами и делать все возможные действия в рамках известных на сегодняшний день законов природы. Это существенно отличает квантовую криптографию от классической, которая опирается на ограничения в вычислительной мощности подслушивателя.

\subsection{Протокол BB84}
Неформально принцип действия всех протоколов квантовой криптографии можно описать следующим образом. Передающая сторона (Алиса) на каждом шаге посылает одно из состояний из неортогонального набора, а принимающая сторона (Боб) производит такое измерение, что после дополнительного обмена классической информацией между сторонами они должны иметь битовые строки, полностью совпадающие в случае идеального канала и отсутствия перехватчика. Ошибки в этих строках могут говорить как о неидеальности канала, так и о действиях подслушивателя. При величине ошибки, превышающей некоторый предел, действие протокола прерывается, иначе же легитимные пользователи могут извлечь полностью секретный ключ из этих частично совпадающих битовых строк.

\subsubsection{Общая схема протокола}
Протокол BB84 \cite{bb84} использует два базиса:
\begin{gather}
  +: \state{0^+} = \state{0},\quad \state{1^+} = \state{1}, \nonumber\\
  \times: \state{0^\times} = \frac{1}{\sqrt{2}}(\state{0} + \state{1}),\quad \state{1^\times} = \frac{1}{\sqrt{2}}(\state{0} - \state{1}).
\end{gather}

На этапе приготовления состояний Алиса случайным образом выбирает один из указанных базисов, а затем случайно выбирает значение бита: 0 или 1, и в соответствии с этим выбором посылает один из четырёх сигналов. При посылке каждого из этих сигналов Алиса запоминает свой выбор базиса и выбор бита, что приводит к появлению на ее стороне двух случайных битовых строк.

Боб, получая каждый из присланных Алисой сигналов, производит над ним одно из двух измерений случайным образом. Каждое из них способно дать достоверный резлуьтат из-за ортогональности состояний внутри каждого базиса:
\begin{eqnarray}\label{bb84_bob_measurements}
  M_0^+ = \state{0^+}\conjstate{0^+}, \qquad M_1^+ = \state{1^+}\conjstate{1^+}, \nonumber\\
  M_0^\times = \state{0^\times}\conjstate{0^\times}, \qquad M_1^\times = \state{1^\times}\conjstate{1^\times}.
\end{eqnarray}
В результате он получает две строки: с выбором базисов и с исходами этих измерений.

Итак, после передачи всех состояний и проведения измерений Алиса и Боб имеют по две строки каждый. Теперь происходит согласование базисов: по открытому каналу Алиса и Боб объявляют друг другу свои строки с выбором базисов. Те посылки, в которых базисы не совпали, выбрасываются. Если базис Алисы совпал с базисом Боба, то в случае отсутствия помех в канале связи результаты в их битовых строках на соответствующей позиции также будут совпадать, поэтому после этапа согласования в случае идеального канала и отсутствия действий со стороны перехватчика Алиса и Боб обладают одними и теми же битовыми строками.

Но если в канале были ошибки или перехватчик пытался подслушать информацию, битовые строки Алисы и Боба могут не совпадать, поэтому для проверки они должны согласованно раскрыть примерно половины своих битовых строк. Согласно центральной предельной теореме, ошибка в раскрытой битовой последовательности дает достаточно точную оценку ошибки во всей последовательности, и по ней можно достаточно точно оценить вероятность ошибки в оставшихся позициях. Если величина ошибки оказывается больше некоторой величины (параметра протокола), передача данных прекращается: это означает, что перехватчик обладает слишком большой информацией о ключе. В противном случае перед Алисой и Бобом стоит задача получения общего секретного ключа, которую можно разбить на два этапа: сначала производится коррекция ошибок \cite{information_reconcilation}, после чего у Алисы и Боба оказываются совпадающие битовые строки; затем происходит усиление секретности \cite{privacy_amplification}, которое ставит своей целью исключить информацию о 
ключе, которая могла попасть к перехватчику в результате действий над состояниями или в ходе коррекции ошибок. В конечном итоге у перехватчика не должно остаться информации об общей битовой строке Алисы и Боба.

\subsubsection{Стойкость протокола}
При предложении протокола BB84 его стойкость была показана только на интуитивном уровне: попытка Евы измерить передаваемые состояния влечет к их разрушению, что приводит к ошибкам на приёмной стороне.
Однако только измерениями посылаемых сигналов действия Евы не ограничиваются. Более того, непросто рассчитать информацию, способную попасть к Еве при всех возможных действиях с её стороны. Однако оказалось, что можно доказать стойкость протокола BB84, не прибегая к оценкам информационных величин для всех возможных атак Евы. В 2000 году было показано \cite{shor_bb84_security_proof}, что секретность квантовой криптографии можно свести к свойствам квантовых кодов коррекции ошибок: если ошибки, возникающие в квантовом канале связи, можно достоверно исправить, то можно добиться и секретной передачи данных. Это даёт критическую величину ошибки, до которой возможно секретное распределение ключей. 

Доказательство стойкости протокола проще всего провести, введя несколько дополнительных протоколов. Так, стойкость введенного первым ЭПР-протокола \cite{e91} легко вытекает из теории квантовых измерений, а последовательным изменением некоторых действий легитимных пользователей он может быть сведен к более строго описанному протоколу BB84 без нарушения исходной секретности \cite{lo_chau, protocol_css}.

Схема протокола, рассмотренная в \cite{protocol_css}, незначительно отличающаяся от описанной выше, использует для коррекции ошибок и усиления секретности свойства CSS-кодов, который не являются оптимальными. Теоретическая оценка на величину ошибки $q$, которую можно исправить в квантовом канале, дается границей Шеннона: $1-2h(q) > 0$. 
Достижение этой границы сводится к использованию случайных классических кодов. Теоретический предел ошибки, до которой возможно секретное распределение информации, равен примерно $11\%$, а именно корню уравнения $1 - 2h(q) = 0$.

\subsubsection{Стратегии подслушивателя}
Итак, утверждается, что при величине ошибки на приемной стороне менее $11\%$ возможна секретная передача данных. В то же время не говорится о том, каким образом протокол теряет секретность при большей величине ошибки. В этом разделе рассмотрены некоторые схемы атаки, на одной из которых достигается теоретический предел ошибки на приемной стороне.
\paragraph{Прием-перепосыл}
Наиболее простой сценарий действий Евы~--- измерение передаваемого по квантовому каналу состояния с дальнейшей пересылкой получившегося результата дальше. Именно таким образом прослушиваются классические каналы. В квантовом случае такая стратегия не работает.

Если Ева стремится произвести те же действия, что производит у себя Боб, то, не зная исходного состояния, она сталкивается с нерешаемой проблемой различения состояний из неортогонального набора. 
Применяя случайным образом одно из измерений (\ref{bb84_bob_measurements})
к посланному состоянию, в половине случаев Ева будет неверно угадывать базис. В силу свойства несмещенности базисных состояний при неверно угаданном базисе вероятность ошибки Евы состоавляет $50\%$, то есть Ева не получает полезной информации о сигнале.

Но это не все проблемы Евы. Неверно угаданный базис при проведении измерения вследствие коллапса волновой функции неизбежно приведет к тому, что Бобу будет послано ошибочное состояние. При применении измерения ``$+$'' вне зависимости от исходного состояния дальше будет послано одно из состояний набора $\{\state{0^+}, \state{1^+}\}$, аналогично с диагональным базисом ``$\times$'' будет послано одно из состояний набора $\{\state{0^\times}, \state{1^\times}\}$. Измеряя эти состояния в <<верном>> для них базисе, Боб получит ошибку, по которой действия Евы будут обнаружены.

Величину ошибки на приёмной стороне можно вычислить так. Допустим, Ева подвергала атаке не все состояния, а только их часть, атакуя каждый сигнал с вероятностью $p$. Тогда доля $1-p$ сигналов приходит к Бобу без ошибки (а Еве приходится просто угадывать значение бита в таких посылках, что вносит в её ошибку вклад, равный $(1-p)/2$). 
Для посылок, атакованных Евой, существует два равновероятных развития событий:
\begin{itemize}
  \item Ева верно угадала базис, значит, точно получила информацию и не внесла возмущения.
  \item Ева ошиблась в выборе базиса. Тогда с вероятностью $1/2$ она получила ошибочный результат. Кроме того, совершенно точно она передала ошибочное состояние Бобу, что приводит к появлению ошибки на его стороне, вероятность которой также равна $1/2$. 
\end{itemize}

Вероятность каждого из этих сценариев равна $p/2$, и нетрудно видеть, что доля ошибок на приёмной стороне будет равна $p/4$, а доля ошибок у Евы составит \begin{equation}\frac{1}{2} - \frac{p}{4}.\end{equation}

Это значит, что при всех значениях параметра $p$, меньших единицы, Ева имеет больше ошибок, чем Боб, и тогда её информация о ключе строго меньше. При $p=1$ доли ошибок у Боба и Евы совпадают и равны $25\%$. Так как ошибка Боба однозначно связана с параметром $p$, то 25\%~--- пороговая величина ошибки для такой атаки, до которой возможно секретное распределение ключей.

\paragraph{Коллективная атака}
Критическая ошибка индивидуального подслушивания, равная 25\% превосходит теоретический порог в 11\%. Возникает вопрос, как Еве нужно изменить схему атаки, чтобы добиться лучших результатов? Оказывается, что слабая сторона индивидуальной атаки~--- в проведении измерений над каждым передаваемым состоянием по отдельности. Из свойства супераддитивности  классически-квантового канала\cite{holevo} следует, что выгоднее проводить измерение над всей последовательностью полученных состояний сразу. В \cite{bb84_collective_attack} показано, что критическая ошибка $Q_c$ для коллективной атаки равна корню уравнения $1 - h(Q_c) = h(Q_c)$, что совпадает с полученным выше теоретическим пределом.

\begin{comment}
\paragraph{Атака с измерениями с тремя исходами} 
Наибольший интерес (в частности для релятивистской квантовой криптографии) представляет собой атака, в которой используются рассмотренные выше измерения с тремя исходами. Суть ее состоит в следующем.
Ева перехватывает каждую отдельную посылку от Алисы к Бобу и проводит над ней измерение с тремя исходами.
Если она получила определенный результат, то она точно знает, какое состояние посылала Алиса, и может приготовить такое же для отправки его дальше Бобу. Если же был получен неопределенный результат, то Еве остается только угадать правильное состояние
\end{comment}
\subsection{Протокол B92}
Протокол BB84 является первым и наиболее изученным протоколом квантовой криптографии. Однако попытки его практической реализации столкнулись с рядом технологических трудностей (о них ниже), в результате чего Ева может провести перехват информации, невозможный при строгой реализации всех принципов протокола BB84. Появилась необходимость разработки протоколов, способных противостоять Еве и на современном уровне развития технологий.

В протоколе BB84 при отсутствии действий перехватчика и помех в канале вероятность ошибки на приёмной стороне до согласования базисов составляет 25\%. Это вызвано использованием строго зафиксированной конфигурации двух пар базисных векторов. Цель протокола B92 \cite{non_orthogonal_states_discrimination_theorem} состоит в возможности изменения этого параметра в зависимости от, например, длины канала или его качества. В ряде случаев это позволяет добиться большей скорости передачи данных.

На каждом шаге протокола B92 Алиса посылает Бобу одно из двух неортогональных состояний \state{\psi_0}, \state{\psi_1}, где $\scalar{\psi_0}{\psi_1} = \cos \eta$~--- основной параметр протокола. На стороне Боба производится измерение с тремя исходами (\ref{unambigious_measurement})
\begin{eqnarray}
  M_0 = \frac{I - \state{\psi_1}\conjstate{\psi_1}}{1 + \cos \eta}, \nonumber\\
  M_1 = \frac{I - \state{\psi_0}\conjstate{\psi_0}}{1 + \cos \eta}, \nonumber\\
  M_? = I - M_0 - M_1.
\end{eqnarray}
Посылки, в которых был получен несовместный исход $M_?$, отбрасываются.

После передачи всех сообщений Алиса и Боб, так же как в BB84, согласованно раскрывают часть своих битовых последовательностей и оценивают число ошибок. Если их оказалось больше некоторой величины, выполнение протокола прерывается, иначе из оставшейся части можно получить полностью секретный ключ. Стойкость протокола относительно наиболее эффективной атаки Евы (коллективной) была исследована в \cite{b92_security_proof}.

\subsection{Проблемы практических реализаций}
Несмотря на заявления о теоретической секретности указанных протоколов, на практике возникают различные трудности.
Первая из них~--- в настоящее время не существует строго однофотонного источника. Современные лазеры выдают так называемые когерентные состояния:
\begin{equation}
\state{\alpha} = e^{-\frac{\mu}{2}} \sum_{n=0}^\infty \frac{\alpha^n}{\sqrt{n!}} \state{n} = e^{-\frac{\mu}{2}}(\state{0} + \alpha \state{1} + \frac{\alpha^2}{2}\state{2} + \cdots),   
\end{equation}
где $\mu = |\alpha|^2$~--- среднее число фотонов, $\state{0} \equiv \state{vac}$~--- вакуумное состояние с числом фотонов 0. Значение параметра $\mu$ находится в районе $0.1-0.2$, что дает вероятность вакуумного состояния примерно $0.9$, вероятность, что в посылке будет ровно один фотон~--- $0.09$, ровно два фотона~--- $0.009$ и т. д.

Проблема неоднофотонных источников дополняется второй~--- помехи и потери в квантовом канале связи. Эти два фактора дают возможность провести атаку с расщеплением по числу фотонов \cite{pns_attack}. Вкратце, Ева может определить число фотонов в посылке. Если их более одного, то она отщепляет себе один фотон, а оставшуюся часть отправляет Бобу. Если фотон в посылке ровно один, эта посылка блокируется и Бобу ничего не посылается, таким образом имитируется потеря посылки из-за плохого качества канала.
После передачи всех состояний у Евы будут храниться фотоны на каждую из принятых Бобом посылок. После раскрытия базисов она проводит соответствующие измерения и полностью знает секретный ключ, не вызвав при этом никаких ошибок на приёмной стороне.

Однако, даже если в распоряжении Алисы имеется строго однофотонный источник, то при наличии потерь в канале Ева все равно может узнать \cite{uds_attack} секретный ключ и остаться незамеченной следующим образом. Над каждой посылкой проводится измерение с тремя исходами. Если был получен совместный результат, Ева точно знает, какое состояние приготовила Алиса, поэтому может приготовить такое же и послать его Бобу. В случае несовместного результата посылка блокируется. Такая стратегия не производит никаких ошибок на приёмной стороне и оставляет подслушивателя незамеченным.

\subsection{Релятивистское квантовое распределение ключей}
Возникает принципиальный вопрос: существуют ли такие протоколы квантового распределения ключей, которые обеспечивают безусловную секретность при не строго однофотонном источнике и произвольных потерях в канале связи? Ответ на этот вопрос: да, существуют. Но для их построения недостаточно опираться исключительно на законы квантовой механики, как это делают все базовые протоколы (BB84\cite{bb84}, B92\cite{non_orthogonal_states_discrimination_theorem}, SARG04\cite{sarg04}. decoy-state\cite{decoy_states_protocol}, phase-time coding\cite{phase_time_protocol}). 

Все эти протоколы не используют тот факт, что фотоны движутся с предельно возможной скоростью света. 
В релятивитской схеме квантового распределения ключей всё взаимодействие происходит в пространстве-времени Минковского, и существенно используется ограничение специальной теории относительности на невозможность движения со скоростями больше скорости света. Основная идея релятивистской схемы состоит в том, чтобы <<растянуть>> информацию и в пространстве, и во времени. Для того, чтобы Ева смогла получить эту информацию, ей придется собрать все части вместе, так как по отдельности они абсолютно бесполезны. Для такого сбора потребуется некоторое время. После получения данных эту информацию потребуется снова разнести в пространстве-времени для соблюдения протокола, на что так же потребуется время. В итоге Ева будет вызывать детектируемые задержки прихода состояний.

Учет фундаментальных ограничений, накладываемых специальной теорией относительности, приводит к тому, что возможна передача секретных ключей на любые расстояния через открытое пространство даже при не строго однофотонном источнике и любых потерях в канале связи.